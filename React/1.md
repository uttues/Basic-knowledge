https://juejin.im/post/6844904072168865800#heading-0

## useState

**è§£å†³äº†çš„é—®é¢˜|ç›®çš„**ï¼š åœ¨**å‡½æ•°ç»„ä»¶**é‡Œé¢ä½¿ç”¨ **classçš„`setState`**ï¼Œè®©å‡½æ•°ç»„ä»¶å¯ä»¥ç»´æŠ¤è‡ªå·±çš„state

**ç”¨æ³•**ï¼š

```js
const [name, setName] = useState('rose')	
```

**æ³¨æ„ç‚¹**ï¼š **useStateçš„åˆå§‹å€¼ï¼Œåªåœ¨ç¬¬ä¸€æ¬¡æœ‰æ•ˆ**

egï¼šç‚¹å‡»æŒ‰é’®ä¿®æ”¹nameçš„å€¼çš„æ—¶å€™ï¼Œåœ¨Childç»„ä»¶ï¼Œ æ˜¯æ”¶åˆ°äº†ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰é€šè¿‡`useState`èµ‹å€¼ç»™nameï¼

```js
const Child = memo(({data}) =>{
    console.log('child render...', data)
    const [name, setName] = useState(data)
    return (
        <div>
            <div>child</div>
            <div>{name} --- {data}</div>
        </div>
    );
})

const Hook =()=>{
    console.log('Hook render...')
    const [count, setCount] = useState(0)
    const [name, setName] = useState('rose')

    return(
        <div>
            <div>
                {count}
            </div>
            <button onClick={()=>setCount(count+1)}>update count </button>
            <button onClick={()=>setName('jack')}>update name </button>
            <Child data={name}/>
        </div>
    )
}
```

## useEffect

**è§£å†³äº†çš„é—®é¢˜|ç›®çš„**ï¼š åœ¨**å‡½æ•°ç»„ä»¶**é‡Œé¢ä½¿ç”¨ **classçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°**ï¼Œå¹¶ä¸”æ˜¯æ‰€æœ‰å‡½æ•°çš„åˆä½“

**ç”¨æ³•**ï¼š

```js
useEffect(()=>{
    ...
})
```

**æ³¨æ„ç‚¹**ï¼š

1. useEffectæœ€åï¼ŒåŠ äº†[]è¡¨ç¤ºåªæœ‰**åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶ä¼šæ‰§è¡Œ**ã€componentDidMountã€‘

2. useEffectæœ€åï¼Œä¸åŠ []å°±è¡¨ç¤º**æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½ä¼šæ‰§è¡Œ**ã€willUpdateç­‰ã€‘

3. useEffectæœ€åï¼Œåœ¨[]ä¸­æ·»åŠ å­—æ®µï¼Œåˆ™**å½“è¿™ä¸ªå­—æ®µæ›´æ”¹æ—¶ï¼Œeffectæ‰æ‰§è¡Œ**

4. åœ¨useEffectçš„**return**é‡Œé¢å¯ä»¥åš**å–æ¶ˆè®¢é˜…**çš„äº‹

   - **ä¸ºä»€ä¹ˆéœ€è¦å–æ¶ˆè®¢é˜…ï¼Ÿ** renderäº†ä¹‹åä¼šæ‰§è¡Œé‡æ–°useEffectï¼Œå¦‚æœuseEffecté‡Œé¢æœ‰ä¸€ä¸ªsetIntervalï¼Œå¤šæ¬¡renderå°±ä¼šå¤šæ¬¡åˆ›å»º

   ```js
   // 1.åŠ []ï¼šåªåœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨çš„componentDidMountï¼Œå¯ä»¥ç”¨æ¥è¯·æ±‚å¼‚æ­¥æ•°æ®
   useEffect(()=>{
       const users = è·å–å…¨å›½äººæ°‘çš„ä¿¡æ¯()
   },[])
   
   // 2.ä¸åŠ []ï¼šç”¨æ¥æ›¿ä»£willUpdateç­‰æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šæ‰§è¡Œçš„ç”Ÿå‘½å‡½æ•°
   useEffect(()=>{
       const users = æ¯æ¬¡éƒ½è·å–å…¨å›½äººæ°‘çš„ä¿¡æ¯()
   })
   
   // 3.[]ä¸­ä¸ªå­—æ®µæ”¹å˜æ—¶æ‰æ‰§è¡Œ
   useEffect(() => {
       const users = ï¼ˆnameæ”¹å˜äº†æˆ‘æ‰è·å–å…¨å›½äººæ°‘çš„ä¿¡æ¯()ï¼‰
   },[name])
   
   // 4.å¯ä»¥åœ¨returnçš„å†…å®¹é‡Œæ‰§è¡Œå–æ¶ˆè®¢é˜…çš„æ“ä½œï¼ˆæ¯”å¦‚åœ¨willUnMountè¿™ä¸ªç”Ÿå‘½å‘¨æœŸé‡Œæ¸…é™¤å®šæ—¶å™¨ï¼‰
   useEffect(() => {
       console.log('use effect...',count)
       const timer = setInterval(() => setCount(count +1), 1000)
       return ()=> clearInterval(timer)
   })
   ```

1. useEffect é‡Œé¢**ä½¿ç”¨åˆ°çš„stateçš„å€¼ä¼šåœ¨useEffectå†…éƒ¨å‡å›º**ï¼Œ **ä¸ä¼šè¢«æ”¹å˜**ï¼Œé™¤éuseEffectåˆ·æ–°ï¼Œé‡æ–°å›ºå®šstateçš„å€¼
2. useEffect**ä¸èƒ½è¢«åˆ¤æ–­åŒ…è£¹**
3. useEffectä¸èƒ½è¢«æ‰“æ–­use

```js
 const [count, setCount] = useState(0)
 useEffect(() => {
     console.log('use effect...',count)
     const timer = setInterval(() => {
         console.log('timer...count:', count)
         setCount(count + 1)
     }, 1000)
     return ()=> clearInterval(timer)
 },[])
    
```

```js
const [count, setCount] = useState(0)
if(2 < 5){
   useEffect(() => {
        console.log('use effect...',count)
        const timer = setInterval(() => setCount(count +1), 1000)
        return ()=> clearInterval(timer)
    }) 
}
```

```js
const [count, setCount] = useState(0)
useEffect(...)

return // å‡½æ•°æå‰ç»“æŸäº†

useEffect(...)
}
```



# useRef

### ä¸ºä»€ä¹ˆè¦ä½¿ç”¨useRefï¼Ÿ

å‰é¢æåˆ°çš„ï¼š

> useEffect é‡Œé¢ä½¿ç”¨åˆ°çš„stateçš„å€¼, å›ºå®šåœ¨äº†useEffectå†…éƒ¨ï¼Œ ä¸ä¼šè¢«æ”¹å˜ï¼Œé™¤éuseEffectåˆ·æ–°ï¼Œé‡æ–°å›ºå®šstateçš„å€¼

```
 const [count, setCount] = useState(0)
    useEffect(() => {
        console.log('use effect...',count)
        const timer = setInterval(() => {
            console.log('timer...count:', count)
            setCount(count + 1)
        }, 1000)
        return ()=> clearInterval(timer)
    },[])
    
å¤åˆ¶ä»£ç 
```

`useEffect`é‡Œé¢çš„stateçš„å€¼ï¼Œæ˜¯å›ºå®šçš„ï¼Œè¿™ä¸ªæ˜¯æœ‰åŠæ³•è§£å†³çš„ï¼Œå°±æ˜¯ç”¨`useRef`ï¼Œå¯ä»¥ç†è§£æˆ`useRef`çš„ä¸€ä¸ªä½œç”¨ï¼š

> å°±æ˜¯ç›¸å½“äºå…¨å±€ä½œç”¨åŸŸï¼Œä¸€å¤„è¢«ä¿®æ”¹ï¼Œå…¶ä»–åœ°æ–¹å…¨æ›´æ–°...

### å¦‚ä½•ä½¿ç”¨useRef?

```
const countRef = useRef(0)

å¤åˆ¶ä»£ç 
```

### useRefçŸ¥è¯†ç‚¹åˆé›†

ğŸ˜„ 1. å°±æ˜¯ç›¸å½“äºå…¨å±€ä½œç”¨åŸŸï¼Œä¸€å¤„è¢«ä¿®æ”¹ï¼Œå…¶ä»–åœ°æ–¹å…¨æ›´æ–°...

```
 const [count, setCount] = useState(0)
 const countRef = useRef(0)
useEffect(() => {
    console.log('use effect...',count)
    const timer = setInterval(() => {
        console.log('timer...count:', countRef.current)
        setCount(++countRef.current)
    }, 1000)
    return ()=> clearInterval(timer)
},[])
å¤åˆ¶ä»£ç 
```

ğŸ˜„ 2. æ™®éæ“ä½œï¼Œç”¨æ¥æ“ä½œdom

> const btnRef = useRef(null)

> click me 

> æ´»å­¦æ´»ç”¨ï¼Œè®°å¾—å–æ¶ˆç»‘å®šäº‹ä»¶å“¦ï¼  return ()=> btnRef.current.removeEventListener('click',onClick, false)

```
const Hook =()=>{
    const [count, setCount] = useState(0)
    const btnRef = useRef(null)

    useEffect(() => {
        console.log('use effect...')
        const onClick = ()=>{
            setCount(count+1)
        }
        btnRef.current.addEventListener('click',onClick, false)
        return ()=> btnRef.current.removeEventListener('click',onClick, false)
    },[count])

    return(
        <div>
            <div>
                {count}
            </div>
            <button ref={btnRef}>click me </button>
        </div>
    )
}
å¤åˆ¶ä»£ç 
```

# useMemo

### ä¸ºä»€ä¹ˆè¦ä½¿ç”¨useMemo?

ä¸¾ä¸ªğŸŒ°ï¼š

```
const Child = memo(({data}) =>{
    console.log('child render...', data.name)
    return (
        <div>
            <div>child</div>
            <div>{data.name}</div>
        </div>
    );
})

const Hook =()=>{
    console.log('Hook render...')
    const [count, setCount] = useState(0)
    const [name, setName] = useState('rose')

    const data = {
        name
    }

    return(
        <div>
            <div>
                {count}
            </div>
            <button onClick={()=>setCount(count+1)}>update count </button>
            <Child data={data}/>
        </div>
    )
}
å¤åˆ¶ä»£ç 
```

å½“æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®æ›´æ–°countçš„æ—¶å€™ï¼ŒEffectç»„ä»¶ä¼šrenderï¼Œä¸€æ—¦renderï¼Œ æ‰§è¡Œåˆ°è¿™ä¸€è¡Œä»£ç ï¼š

```
   const data = {
        name
    }
å¤åˆ¶ä»£ç 
```

è¿™ä¸€è¡Œä»£ç ä¼šç”Ÿæˆæœ‰æ–°çš„å†…å­˜åœ°å€çš„å¯¹è±¡ï¼Œé‚£ä¹ˆå°±ç®—å¸¦ç€memoçš„Childç»„ä»¶ï¼Œä¹Ÿä¼šè·Ÿç€é‡æ–°renderï¼Œ å°½ç®¡æœ€åå…¶å®Childä½¿ç”¨åˆ°çš„å€¼æ²¡æœ‰æ”¹å˜ï¼

è¿™æ ·å°±å¤šä½™renderäº†ï¼Œæ„Ÿè§‰æ€§èƒ½æµªè´¹äº†ï¼äºæ˜¯`useMemo` ä½œä¸ºä¸€ä¸ªæœ‰ç€æš‚å­˜èƒ½åŠ›çš„ï¼Œå°±æ¥äº†ã€‚

### å¦‚ä½•ä½¿ç”¨useMemo?

```
  const data = useMemo(()=>{
        return {
            name
        }
    },[name])
å¤åˆ¶ä»£ç 
```

çš„æ—¶å€™ï¼Œå°±ä¼šå…ˆæ ¹æ®`[name]`é‡Œé¢çš„nameå€¼åˆ¤æ–­ä¸€ä¸‹ï¼Œå› ä¸º`useMemo` ä½œä¸ºä¸€ä¸ªæœ‰ç€æš‚å­˜èƒ½åŠ›çš„ï¼Œæš‚å­˜äº†ä¸Šä¸€æ¬¡çš„nameç»“æœã€‚

ç»“æœä¸€å¯¹æ¯”ä¸Šä¸€æ¬¡çš„nameï¼Œæˆ‘ä»¬å‘ç°nameå€¼å±…ç„¶æ²¡æœ‰æ”¹å˜ï¼é‚£ä¹ˆè¿™æ¬¡dataå°±ä¸é‡æ–°èµ‹å€¼æˆæ–°çš„å¯¹è±¡äº†ï¼

æ²¡æœ‰æ–°çš„å¯¹è±¡ï¼Œå°±æ²¡æœ‰æ–°çš„å†…å­˜åœ°å€ï¼Œé‚£ä¹ˆChildå°±ä¸ä¼šé‡æ–°renderï¼

```
const Child = memo(({data}) =>{
    console.log('child render...', data.name)
    return (
        <div>
            <div>child</div>
            <div>{data.name}</div>
        </div>
    );
})

const Hook =()=>{
    console.log('Hook render...')
    const [count, setCount] = useState(0)
    const [name, setName] = useState('rose')

   const data = useMemo(()=>{
        return {
            name
        }
    },[name])
    
    return(
        <div>
            <div>
                {count}
            </div>
            <button onClick={()=>setCount(count+1)}>update count </button>
            <Child data={data}/>
        </div>
    )
}
å¤åˆ¶ä»£ç 
```

### useMemoçŸ¥è¯†ç‚¹åˆé›†

`useMemo` ä¸€çœ‹ å°±æ„Ÿè§‰è·Ÿåˆ°memoæœ‰ç§èœœæ±å…³ç³»ï¼Œå› ä¸ºéƒ½æœ‰memo...

ğŸ˜„ 1. é¦–å…ˆï¼Œ`memo` çš„ç”¨æ³•æ˜¯ï¼š`å‡½æ•°ç»„ä»¶é‡Œé¢çš„PureComponent`

> ä½†æ˜¯ï¼Œå¦‚æœå‡½æ•°ç»„ä»¶è¢« React.memo åŒ…è£¹ï¼Œä¸”å…¶å®ç°ä¸­æ‹¥æœ‰ useState æˆ– useContext çš„ Hookï¼Œå½“ context å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒä»ä¼šé‡æ–°æ¸²æŸ“ã€‚

ğŸ˜„ 2. è€Œä¸”ï¼Œ`memo`æ˜¯æµ…æ¯”è¾ƒï¼Œæ„æ€æ˜¯ï¼Œå¯¹è±¡åªæ¯”è¾ƒå†…å­˜åœ°å€ï¼Œåªè¦ä½ å†…å­˜åœ°å€æ²¡å˜ï¼Œç®¡ä½ å¯¹è±¡é‡Œé¢çš„å€¼åƒå˜ä¸‡åŒ–éƒ½ä¸ä¼šè§¦å‘render

ğŸ˜„ 3. æœ€åï¼Œ`useMemo` çš„ä½œç”¨æ˜¯ï¼Œ äºæ˜¯`useMemo` ä½œä¸ºä¸€ä¸ªæœ‰ç€æš‚å­˜èƒ½åŠ›çš„ï¼Œå°±æ¥äº†ï¼š

# useCallback

### ä¸ºä»€ä¹ˆè¦ä½¿ç”¨useCallbackï¼Ÿ

useMemo è§£å†³äº†å€¼çš„ç¼“å­˜çš„é—®é¢˜ï¼Œé‚£ä¹ˆå‡½æ•°å‘¢ï¼Ÿ

ä¸‹é¢è¿™ä¸ªğŸŒ°å°±æ˜¯ï¼Œå½“ç‚¹å‡»countçš„æŒ‰é’®ï¼ŒEffectç»„ä»¶renderï¼Œé‡åˆ°äº†ï¼š

```
   const onChange=(e)=>{
        setText(e.target.value)
   }
    
å¤åˆ¶ä»£ç 
```

åˆ™ï¼Œé‡æ–°ç”Ÿæˆäº†ä¸€ä¸ª`onChange`å‡½æ•°ï¼Œèµ‹å€¼ç»™äº†Childç»„ä»¶ï¼Œæµ…æ¯”è¾ƒå¤±è´¥ï¼ŒChildç»„ä»¶æˆåŠŸé‡æ–°renderï¼Œå°½ç®¡Childç»„ä»¶ä»€ä¹ˆéƒ½æ²¡æœ‰åšï¼

```
const Child = memo(({data, onChange}) =>{
    console.log('child render...')
    return (
        <div>
            <div>child</div>
            <div>{data}</div>
            <input type="text" onChange={onChange}/>
        </div>
    );
})

const Hook =()=>{
    console.log('Hook render...')
    const [count, setCount] = useState(0)
    const [name, setName] = useState('rose')
    const [text, setText] = useState('')

   const onChange=(e)=>{
        setText(e.target.value)
   }
    
    return(
        <div>
            <div>count: {count}</div>
            <div>text : {text}</div>
            <button onClick={()=>setCount(count + 1)}>count + 1</button>
            <Child data={name} onChange={onChange}/>
        </div>
    )
}

å¤åˆ¶ä»£ç 
```

### å¦‚ä½•ä½¿ç”¨useCallbackï¼Ÿ

```
   const onChange = useCallback((e)=>{
        setText(e.target.value)
   },[])
å¤åˆ¶ä»£ç 
```

### useCallback çŸ¥è¯†ç‚¹åˆé›†

ğŸ˜„1.`useMemo` ä¸ `useCallback` ç±»ä¼¼ï¼Œéƒ½æ˜¯æœ‰ç€ç¼“å­˜çš„ä½œç”¨ã€‚æœ¬è´¨çš„åŒºåˆ«å¯èƒ½å°±æ˜¯ï¼š

> useMemo æ˜¯ç¼“å­˜å€¼çš„

> useCallback æ˜¯ç¼“å­˜å‡½æ•°çš„

ğŸ˜„2.æ²¡æœ‰ä¾èµ–ï¼Œæ·»åŠ ç©ºçš„ä¾èµ–ï¼Œå°±æ˜¯ç©ºæ•°ç»„ï¼

# useReducer

### ä¸ºä»€ä¹ˆè¦ä½¿ç”¨useReducerï¼Ÿ

é¡¾åæ€ä¹‰ï¼Œ`useReducer`å°±æ˜¯ class é‡Œé¢é‚£ä¸ªreducer

### å¦‚ä½•ä½¿ç”¨useReducerï¼Ÿ

ä¸¾ä¸ªğŸŒ°ï¼š

```
const reducer =(state = 0, {type})=>{
    switch (type) {
        case "add":
            return state+1
        case 'delete':
            return state-1
        default:
            return state;
    }
}

const Hook =()=>{
    const [count, dispatch] = useReducer(reducer, 0)
    return(
        <div>
           count:{count}
           <button onClick={()=> dispatch({type:'add'})}>add</button>
            <button onClick={()=> dispatch({type:'delete'})}>delete</button>
        </div>
    )
}

export default Hook
å¤åˆ¶ä»£ç 
```

### useReducerçŸ¥è¯†ç‚¹åˆé›†

æš‚æ— ç‰¹åˆ«çš„...ğŸ˜¼

# useContext

### ä¸ºä»€ä¹ˆè¦ä½¿ç”¨useContextï¼Ÿ

`useContext` å°±æ˜¯ class é‡Œé¢çš„ é‚£ä¸ª contextã€‚

### å¦‚ä½•ä½¿ç”¨useContextï¼Ÿ

```
import React, {useContext, useReducer} from 'react'

const reducer = (state = 0, {type}) => {
    switch (type) {
        case "add":
            return state + 1
        case 'delete':
            return state - 1
        default:
            return state;
    }
}
const Context = React.createContext(null);

const Child = () => {
    const [count, dispatch] = useContext(Context)
    return (
        <div>
            <div>child...{count}</div>
            <button onClick={() => dispatch({type: 'add'})}>child add</button>
            <button onClick={() => dispatch({type: 'delete'})}>child delete</button>
        </div>

    )
}

const Hook = () => {
    const [count, dispatch] = useReducer(reducer, 10)
    return (
        <Context.Provider value={[count, dispatch]}>
            <div>
                <div>mom ... {count}</div>
                <Child/>
                <button onClick={() => dispatch({type: 'add'})}>mom add</button>
                <button onClick={() => dispatch({type: 'delete'})}>mom delete</button>
            </div>
        </Context.Provider>
    )
}

export default Hook

å¤åˆ¶ä»£ç 
```

### useContextçŸ¥è¯†ç‚¹åˆé›†

æš‚æ— ç‰¹åˆ«çš„...ğŸ˜¼

# è‡ªå®šä¹‰hookï¼

è‡ªå®šä¹‰ä¸€ä¸ªå½“resize çš„æ—¶å€™ ç›‘å¬windowçš„widthå’Œheightçš„hook

```
import {useEffect, useState} from "react";

export const useWindowSize = () => {
    const [width, setWidth] = useState()
    const [height, setHeight] = useState()

    useEffect(() => {
        const {clientWidth, clientHeight} = document.documentElement
        setWidth(clientWidth)
        setHeight(clientHeight)
    }, [])

    useEffect(() => {
        const handleWindowSize = () =>{
            const {clientWidth, clientHeight} = document.documentElement
            setWidth(clientWidth)
            setHeight(clientHeight)
        };

        window.addEventListener('resize', handleWindowSize, false)

        return () => {
            window.removeEventListener('resize',handleWindowSize, false)
        }
    })

    return [width, height]
}

å¤åˆ¶ä»£ç 
```

å¦‚ä½•ä½¿ç”¨ï¼š

```
const [width, height] = useWindowSize()
```


ä½œè€…ï¼šè¥¿é—¨å¹å–µ
é“¾æ¥ï¼šhttps://juejin.im/post/6844904072168865800
æ¥æºï¼šæ˜é‡‘
è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚